!function(e){var n={};function t(r){if(n[r])return n[r].exports;var a=n[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,t),a.l=!0,a.exports}t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var a in e)t.d(r,a,function(n){return e[n]}.bind(null,a));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=4)}([function(e,n,t){"use strict";n.__esModule=!0,n.ADD_ERROR="ADD_ERROR",n.REMOVE_ERROR="REMOVE_ERROR",n.CLEAR_ERRORS="CLEAR_ERRORS",n.ADD_INFO="ADD_INFO",n.REMOVE_INFO="REMOVE_INFO",n.CLEAR_INFOS="CLEAR_INFOS",n.addError=function(e){return{type:n.ADD_ERROR,data:e}},n.removeError=function(e){return{type:n.REMOVE_ERROR,data:e}},n.clearErrors=function(){return{type:n.CLEAR_ERRORS}},n.addInfo=function(e){return{type:n.ADD_INFO,data:e}},n.removeInfo=function(e){return{type:n.REMOVE_INFO,data:e}},n.clearInfos=function(){return{type:n.CLEAR_INFOS}}},function(e,n){e.exports=require("axios")},function(e,n){e.exports=require("mocha")},function(e,n,t){"use strict";var r=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))(function(a,s){function o(e){try{u(r.next(e))}catch(e){s(e)}}function i(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){e.done?a(e.value):new t(function(n){n(e.value)}).then(o,i)}u((r=r.apply(e,n||[])).next())})},a=this&&this.__generator||function(e,n){var t,r,a,s,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,r&&(a=2&s[0]?r.return:s[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,s[1])).done)return a;switch(r=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){o.label=s[1];break}if(6===s[0]&&o.label<a[1]){o.label=a[1],a=s;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(s);break}a[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(e,o)}catch(e){s=[6,e],r=0}finally{t=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}},s=this;n.__esModule=!0;var o=t(1),i=t(0);n.ADD_CHANNELS="ADD_CHANNELS",n.SET_CHANNEL_FETCHING_NEW_MESSAGES="SET_CHANNEL_FETCHING_NEW_MESSAGES",n.SET_CHANNEL_HAS_MORE_MESSAGES="SET_CHANNEL_HAS_MORE_MESSAGE",n.ADD_RECEIVED_CHANNEL_MESSAGE="ADD_RECEIVED_CHANNEL_MESSAGE",n.ADD_RETRIEVED_CHANNEL_MESSAGES="ADD_RETRIEVED_CHANNEL_MESSAGES",n.INCREMENT_CHANNEL_RETRIEVE_MESSAGES_OFFSET="INCREMENT_CHANNEL_RETRIEVE_MESSAGES_OFFSET",n.RETRIEVE_CHANNEL_MESSAGES="RETRIEVE_CHANNEL_MESSAGES",n.CLEAR_CHANNELS_DATA="CLEAR_CHANNELS_DATA",n.addChannels=function(e){var t=[];return e.forEach(function(e){t.push({name:e,messages:[],retrieveMessagesOffset:0,hasMoreMessages:!0,fetchingNewMessages:!1})}),{type:n.ADD_CHANNELS,data:{channels:t}}},n.incrementChannelRetrieveMessagesOffset=function(e,t){return{type:n.INCREMENT_CHANNEL_RETRIEVE_MESSAGES_OFFSET,data:{channel:e,increment:t}}},n.setChannelFetchingNewMessages=function(e,t){return{type:n.SET_CHANNEL_FETCHING_NEW_MESSAGES,data:{channelName:e,isFetching:t}}},n.setChannelHasMoreMessages=function(e,t){return{type:n.SET_CHANNEL_HAS_MORE_MESSAGES,data:{channelName:e,hasMore:t}}},n.addReceivedChannelMessage=function(e,t){return{type:n.ADD_RECEIVED_CHANNEL_MESSAGE,data:{message:t,channelName:e}}},n.addRetrievedChannelMessages=function(e,t){return{type:n.ADD_RETRIEVED_CHANNEL_MESSAGES,data:{channelName:e,messages:t}}},n.clearChannelsData=function(){return{type:n.CLEAR_CHANNELS_DATA}},n.fetchChannels=function(){return function(e){return o.default.get("/api/v1/channels").then(function(t){var r=t.data.channels.map(function(e){return e.name});return e(n.addChannels(r))}).catch(function(n){return console.log(n),e(i.addError("Something went wrong while trying to fetch the channels"))})}},n.retrieveChannelMessages=function(e){return function(t,u){return r(s,void 0,void 0,function(){var r;return a(this,function(a){return(r=u().channels.find(function(n){return n.name===e}))&&!r.fetchingNewMessages&&r.hasMoreMessages?(t(n.setChannelFetchingNewMessages(r.name,!0)),[2,o.default.get("/api/v1/messages/"+r.name+"/"+r.retrieveMessagesOffset).then(function(a){if(0===a.data.messages.length)return t(n.setChannelHasMoreMessages(r.name,!1)),a;t(n.incrementChannelRetrieveMessagesOffset(e,20)),t(n.addRetrievedChannelMessages(r.name,a.data.messages))}).catch(function(e){console.log("Error fetching messages",r,e),t(i.addError("Something went wrong while trying to fetch messages"))}).then(function(){return t(n.setChannelFetchingNewMessages(r.name,!1))})]):(console.log("Retrieve Channel Messages dispatched with incorrect channel name or while already fetching messages",e,u()),[2,Promise.resolve()])})})}},n.deleteChannel=function(e){return function(t){return o.default.get("/api/v1/channel/delete/"+e).then(function(e){return t(i.addInfo("Channel deleted")),t(n.fetchChannels())}).catch(function(e){return console.log("Error deleting channel",e),t(i.addError(e.response.data.error))})}},n.addChannel=function(e){return function(t){return o.default.post("/api/v1/channel/create",{channelName:e}).then(function(e){return t(i.addInfo("Channel created")),t(n.fetchChannels())}).catch(function(e){return console.log("Error creating chanel",e),t(i.addError(e.response.data.error))})}}},function(e,n,t){t(5),t(23)},function(e,n,t){"use strict";n.__esModule=!0;var r=t(6),a=t(7);t(2);var s=t(8);describe("Store and Synchronous Actions",function(){describe("User State",function(){var e,n;beforeEach(function(){e=a.cloneDeep(s.default),n=e.getState().user}),it("should not be authorized",function(){r.assert.isFalse(n.authorized),r.assert.isFalse(n.email),r.assert.isFalse(n.name),r.assert.isFalse(n.role)}),it("should be authorized after setAuthorized action"),it("should have user data after setting the user"),it("should not have user data after logging out")}),describe("Channels State",function(){it("should add channels from an array of channel names"),it("should update fetchingNewMessages after calling setChannelFetchingNewMessages action"),it("should increment the channel offset for retrieving new messages"),it("should update the hasMoreMessages property on a channel"),it("should add a received message to the appropriate channel"),it("should add retreived messages to the appropriate channel"),it("should clear all channel data")}),describe("Notifications State",function(){it("should add errors"),it("should remove errors given an index"),it("should clear errors"),it("should add info"),it("should remove info given an index"),it("should clear infos")}),describe("Sidebar State",function(){it("should toggle open state")}),describe("Socket State",function(){it("should set the socket given an opened SocketIOClient Socket"),it("should update the connected state"),it("should update the connected users")}),describe("Chat Users State",function(){it("should update users"),it("should add a user"),it("should remove a user")})})},function(e,n){e.exports=require("chai")},function(e,n){e.exports=require("lodash")},function(e,n,t){"use strict";n.__esModule=!0;var r=t(9),a=t(10),s=t(11),o=t(12),i=t(14),u=t(15),c=t(16),d=t(18),l=t(21),E=r.combineReducers({user:o.default,channels:i.default,notifications:u.default,sidebar:c.default,socket:d.default,chatUsers:l.default});n.default=r.createStore(E,r.applyMiddleware(a.default,s.createLogger()))},function(e,n){e.exports=require("redux")},function(e,n){e.exports=require("redux-thunk")},function(e,n){e.exports=require("redux-logger")},function(e,n,t){"use strict";n.__esModule=!0;var r=t(13),a={authorized:!1,email:!1,name:!1,role:!1};n.default=function(e,n){switch(void 0===e&&(e=a),n.type){case r.SET_AUTHORIZED:return"boolean"!=typeof n.data?(console.error("Data must be boolean for SET_AUTHORIZED action"),e):!1===n.data?Object.assign({},e,{authorized:!1,email:!1}):Object.assign({},e,{authorized:n.data});case r.SET_USER:return Object.assign({},e,n.data);case r.LOGOUT_USER:return{authorized:!1,name:!1,email:!1,role:!1};default:return e}}},function(e,n,t){"use strict";n.__esModule=!0;var r=t(1),a=t(3),s=t(0);n.SET_AUTHORIZED="SET_AUTHORIZED",n.SET_USER="SET_USER",n.LOGOUT_USER="LOGOUT_USER",n.setAuthorized=function(e){return{type:n.SET_AUTHORIZED,data:e}},n.setUser=function(e){return{type:n.SET_USER,data:e}},n.logoutUser=function(){return{type:n.LOGOUT_USER}},n.logout=function(){return function(e){return e(n.logoutUser()),e(a.clearChannelsData())}},n.updateName=function(e,n){return function(t){return r.default.post("/api/v1/user/update/name",{name:e}).then(function(e){t(s.addInfo("Name updated")),n&&n()}).catch(function(e){if(e.response&&e.response.data.error)return t(s.addError(e.response.data.error));console.log("Something went wrong updating user name",e),t(s.addError("Something went wrong while trying to update your name."))})}},n.updateEmail=function(e,n){return function(t){return r.default.post("/api/v1/user/update/email",{email:e}).then(function(e){t(s.addInfo("Email updated")),n&&n()}).catch(function(e){if(e.response&&e.response.data.error)return t(s.addError(e.response.data.error));console.log("Something went wrong updating user email",e),t(s.addError("Something went wrong while trying to update your email."))})}},n.updatePassword=function(e,n,t){return function(a){return r.default.post("/api/v1/user/update/password",{oldPass:e,newPass:n}).then(function(e){a(s.addInfo("Password updated")),t&&t()}).catch(function(e){if(e.response&&e.response.data.error)return a(s.addError(e.response.data.error));console.log("Something went wrong updating user password",e),a(s.addError("Something went wrong while trying to update your password."))})}}},function(e,n,t){"use strict";n.__esModule=!0;var r=t(3),a=[];n.channelExists=function(e,n){var t=e.find(function(e){return e.name===n});return t||!1},n.default=function(e,t){switch(void 0===e&&(e=a),t.type){case r.ADD_CHANNELS:return t.data.channels;case r.INCREMENT_CHANNEL_RETRIEVE_MESSAGES_OFFSET:var s=n.channelExists(e,t.data.channel),o=t.data.increment;return s?e.map(function(e){return e.name===s.name&&(e.retrieveMessagesOffset+=o),e}):(console.log("Unknown channel while incrementing messages offset",t),e);case r.SET_CHANNEL_FETCHING_NEW_MESSAGES:return n.channelExists(e,t.data.channelName)?e.map(function(e){return e.name===t.data.channelName&&(e.fetchingNewMessages=t.data.isFetching),e}):(console.log("Unknown channel while fetching new messages",t),e);case r.SET_CHANNEL_HAS_MORE_MESSAGES:var i=n.channelExists(e,t.data.channelName),u=t.data.hasMore;return i?e.map(function(e){return e.name===t.data.channelName&&(e.hasMoreMessages=u),e}):(console.log("Unknown channel while setting hasMore messages",t),e);case r.ADD_RETRIEVED_CHANNEL_MESSAGES:var c=t.data.messages,d=t.data.channelName;return n.channelExists(e,d)?e.map(function(e){return e.name===d&&(e.messages=c.concat(e.messages)),e}):(console.log("Unknown channel while adding retrieved channel messages",t),e);case r.ADD_RECEIVED_CHANNEL_MESSAGE:var l=t.data.message,E=t.data.channelName;return n.channelExists(e,E)?e.map(function(e){return e.name===E&&(e.messages=e.messages.concat([l])),e}):(console.log("Unknown channel while adding received message",e,t),e);case r.CLEAR_CHANNELS_DATA:return[];default:return e}}},function(e,n,t){"use strict";n.__esModule=!0;var r=t(0),a={errors:[],infos:[]};n.default=function(e,n){switch(void 0===e&&(e=a),n.type){case r.ADD_ERROR:return Object.assign({},e,{errors:e.errors.concat([n.data])});case r.REMOVE_ERROR:var t=e.errors.slice();return t.splice(n.data,1),Object.assign({},e,{errors:t});case r.CLEAR_ERRORS:return Object.assign({},e,{errors:[]});case r.ADD_INFO:return Object.assign({},e,{infos:e.infos.concat([n.data])});case r.REMOVE_INFO:var s=e.infos.slice();return s.splice(n.data,1),Object.assign({},e,{infos:s});case r.CLEAR_INFOS:return Object.assign({},e,{infos:[]});default:return e}}},function(e,n,t){"use strict";n.__esModule=!0;var r=t(17),a={open:!0};n.default=function(e,n){switch(void 0===e&&(e=a),n.type){case r.TOGGLE_SIDEBAR_OPEN:return Object.assign({},e,{open:!e.open});default:return e}}},function(e,n,t){"use strict";n.__esModule=!0,n.TOGGLE_SIDEBAR_OPEN="TOGGLE_SIDEBAR_OPEN",n.toggleSidebarOpen=function(){return{type:n.TOGGLE_SIDEBAR_OPEN}}},function(e,n,t){"use strict";n.__esModule=!0;var r=t(19),a={io:null,connected:!1,connectedUserEmails:[]};n.default=function(e,n){switch(void 0===e&&(e=a),n.type){case r.INIT_WEBSOCKET:return Object.assign({},e,{io:n.data.io});case r.SET_SOCKET_CONNECTED:return Object.assign({},e,{connected:n.data.connected});case r.SET_SOCKET_CONNECTED_USERS:return Object.assign({},e,{connectedUserEmails:n.data.userEmails});default:return e}}},function(e,n,t){"use strict";n.__esModule=!0;var r=t(20);n.INIT_WEBSOCKET="INIT_WEBSOCKET",n.SET_SOCKET_CONNECTED="SET_SOCKET_CONNECTED",n.SET_SOCKET_CONNECTED_USERS="SET_SOCKET_CONNECTED_USERS",n.initWebsocket=function(e){return{type:n.INIT_WEBSOCKET,data:{io:e}}},n.setSocketConnected=function(e){return{type:n.SET_SOCKET_CONNECTED,data:{connected:e}}},n.setSocketConnectedUsers=function(e){return{type:n.SET_SOCKET_CONNECTED_USERS,data:{userEmails:e}}},n.init=function(){return function(e){var t=r();return t.on("connect",function(){e(n.setSocketConnected(!0)),console.log("Connected to websocket server ["+t.id+"]")}),t.on("disconnect",function(){e(n.setSocketConnected(!1)),console.log("Disconnected from websocket server, attempting reconnect")}),t.on("connected users",function(t){e(n.setSocketConnectedUsers(t))}),e(n.initWebsocket(t))}}},function(e,n){e.exports=require("socket.io-client")},function(e,n,t){"use strict";n.__esModule=!0;var r=t(22),a={};n.default=function(e,n){var t;switch(void 0===e&&(e=a),n.type){case r.UPDATE_CHAT_USERS:return n.data.users;case r.ADD_CHAT_USER:return Object.assign({},e,((t={})[n.data.user.email]={role:n.data.user.role,name:n.data.user.name},t));case r.REMOVE_CHAT_USER:delete Object.assign({},e)[n.data.email];default:return e}}},function(e,n,t){"use strict";n.__esModule=!0;var r=t(1),a=t(0);n.UPDATE_CHAT_USERS="UPDATE_CHAT_USERS",n.ADD_CHAT_USER="ADD_USER",n.REMOVE_CHAT_USER="REMOVE_USER",n.updateUsers=function(e){return{type:n.UPDATE_CHAT_USERS,data:{users:e}}},n.addUser=function(e){return{type:n.ADD_CHAT_USER,data:{user:e}}},n.removeUser=function(e){return{type:n.REMOVE_CHAT_USER,data:{email:e}}},n.fetchAllUsers=function(){return function(e){r.default.get("/api/v1/users").then(function(t){var r={};return t.data.users.forEach(function(e){r[e.email]={role:e.role,name:e.name}}),e(n.updateUsers(r)),t}).catch(function(n){return e(a.addError("Fetching all users failed")),console.log(n),n})}},n.createNewUser=function(e){},n.editUser=function(e,n){},n.deleteUser=function(e){}},function(e,n,t){"use strict";n.__esModule=!0,t(2);var r=t(7),a=t(8);describe("Async Actions",function(){beforeEach(function(){r.cloneDeep(a.default)}),describe("User async actions",function(){it("should update name"),it("should update email"),it("should update password")}),describe("Channels async actions",function(){it("should fetch channels"),it("should retrieve channel messages"),it("should delete channel"),it("should create new channel")}),describe("Socket async actions",function(){it("should initialize websocket connection")}),describe("Chat Users async actions",function(){it("should fetch all users"),it("should create a new user"),it("should edit the user"),it("should delete the user")})})}]);
//# sourceMappingURL=all-tests.js.map